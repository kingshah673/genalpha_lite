{% extends "layouts/base.html" %}

{% block title %}Shopping Cart - BrandStore{% endblock %}

{% block content %}
<div class="bg-white">
    <div class="container-custom py-16 sm:py-24">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900 mb-10">Shopping Cart</h1>

        {% if cart|length > 0 %}
        <div class="lg:grid lg:grid-cols-12 lg:gap-x-12 lg:items-start xl:gap-x-16">
            <section class="lg:col-span-7">
                <ul role="list" class="divide-y divide-gray-200 border-t border-b border-gray-200">
                    {% for item in cart %}
                    <li class="flex py-6 sm:py-10">
                        <div class="flex-shrink-0">
                            {% if item.product.primary_image %}
                            <img src="{{ item.product.primary_image.image.url }}" alt="{{ item.product.primary_image.alt_text }}" class="h-24 w-24 rounded-md object-cover object-center sm:h-48 sm:w-48">
                            {% else %}
                            <div class="h-24 w-24 rounded-md bg-gray-100 flex items-center justify-center text-gray-400 sm:h-48 sm:w-48">No Image</div>
                            {% endif %}
                        </div>

                        <div class="ml-4 flex flex-1 flex-col justify-between sm:ml-6">
                            <div class="relative pr-9 sm:grid sm:grid-cols-2 sm:gap-x-6 sm:pr-0">
                                <div>
                                    <div class="flex justify-between">
                                        <h3 class="text-sm">
                                            <a href="/shop/product/{{ item.product.slug }}/" class="font-medium text-gray-700 hover:text-gray-800">{{ item.product.name }}</a>
                                        </h3>
                                    </div>
                                    <div class="mt-1 flex text-sm">
                                        <p class="text-gray-500">
                                            {% if item.variant %}{{ item.variant.size }} | {{ item.variant.color }}{% else %}Standard{% endif %}
                                        </p>
                                    </div>
                                    <p class="mt-1 text-sm font-medium text-gray-900">${{ item.price }}</p>
                                </div>

                                <div class="mt-4 sm:mt-0 sm:pr-9">
                                    <form class="flex items-center" hx-post="/cart/update/" hx-target="body" hx-swap="morph">
                                        <label for="quantity-{{ item.product_id }}" class="sr-only">Quantity, {{ item.product.name }}</label>
                                        <div class="flex items-center border border-gray-300 rounded-md">
                                            <button type="button" class="px-3 py-1 text-gray-600 hover:bg-gray-100" @click="$el.nextElementSibling.stepDown(); $el.nextElementSibling.dispatchEvent(new Event('change'))">-</button>
                                            <!-- Note: full cart page update might be simpler with full page reload for now, or just use HTMX to update cart part. 
                                                 For simplicity in MVP, let's keep full page standard form submission or just reuse the drawer logic but simpler. 
                                                 Let's effectively redirect to cart page on update to refresh. -->
                                            <input type="number" name="quantity" value="{{ item.quantity }}" min="1" 
                                                   class="w-12 text-center border-none p-1 focus:ring-0"
                                                   onchange="this.form.submit()">
                                            <button type="button" class="px-3 py-1 text-gray-600 hover:bg-gray-100" @click="$el.previousElementSibling.stepUp(); $el.previousElementSibling.dispatchEvent(new Event('change'))">+</button>
                                        </div>
                                        <input type="hidden" name="product_id" value="{{ item.product_id }}">
                                        <input type="hidden" name="variant_id" value="{{ item.variant_id }}">
                                        <!-- Hack: override hx-post to normal post for full page reload on cart page for simplicity unless we morph -->
                                    </form>

                                    <div class="absolute top-0 right-0">
                                        <form method="POST" action="{% url 'cart:remove' %}">
                                            {% csrf_token %}
                                            <input type="hidden" name="product_id" value="{{ item.product_id }}">
                                            <input type="hidden" name="variant_id" value="{{ item.variant_id }}">
                                            <button type="submit" class="-m-2 inline-flex p-2 text-gray-400 hover:text-gray-500">
                                                <span class="sr-only">Remove</span>
                                                <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                    <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                                                </svg>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </section>

            <!-- Order Summary -->
            <section class="mt-16 rounded-lg bg-gray-50 px-4 py-6 sm:p-6 lg:col-span-5 lg:mt-0 lg:p-8">
                <h2 class="text-lg font-medium text-gray-900">Order summary</h2>

                <dl class="mt-6 space-y-4">
                    <div class="flex items-center justify-between border-t border-gray-200 pt-4">
                        <dt class="text-base font-medium text-gray-900">Order total</dt>
                        <dd class="text-base font-medium text-gray-900">${{ cart.get_total_price }}</dd>
                    </div>
                </dl>

                <div class="mt-6">
                    <a href="/orders/checkout/" class="w-full rounded-md border border-transparent bg-black px-4 py-3 text-base font-medium text-white shadow-sm hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-gray-50 block text-center">Checkout</a>
                </div>
            </section>
        </div>
        {% else %}
        <div class="text-center py-24">
            <h3 class="mt-2 text-lg font-medium text-gray-900">Your cart is empty</h3>
            <p class="mt-1 text-sm text-gray-500">Add some stylish items to your wardrobe.</p>
            <div class="mt-6">
                <a href="/shop/" class="btn-primary">Continue Shopping</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
